<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Food Track</title>
    <link rel="stylesheet" href="/static/css/chart.css" />
    <link rel="stylesheet" href="/static/css/style.css" />
    <link rel="stylesheet" href="/static/css/community.css" />
    <link rel="stylesheet" href="/static/css/track.css" />
    <!-- Bootstrap CSS -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" />

    <!-- bootstrap core css -->
    <link rel="stylesheet" type="text/css" href="/static/css/bootstrap.css" />

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
    <!-- fonts style -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700;900&display=swap" rel="stylesheet" />

    <!-- owl slider stylesheet -->
    <link rel="stylesheet" type="text/css"
        href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.carousel.min.css" />

    <!-- font awesome style -->
    <link href="/static/css/font-awesome.min.css" rel="stylesheet" />
    <!-- nice select -->
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/jquery-nice-select/1.1.0/css/nice-select.min.css"
        integrity="sha256-mLBIhmBvigTFWPSCtvdu6a76T+3Xyt+K571hupeFLg4=" crossorigin="anonymous" />
    <!-- datepicker -->
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.3.0/css/datepicker.css" />
    <!-- Custom styles for this template -->
    <link href="/static/css/style.css" rel="stylesheet" />
    <link href="/static/css/community.css" rel="stylesheet" />
    <!-- responsive style -->
    <link href="/static/css/responsive.css" rel="stylesheet" />
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />

    {% csrf_token %}
    <script>
        const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value;
    </script>
</head>

<body style="background-color: #00c6a9">
    <div class="hero_area">
        <!-- header section starts -->
        <header class="header_section">
            <div class="header_bottom">
                <div class="container-fluid d-flex justify-content-between align-items-center">
                    <a href="/" class="logo-nugibot">
                        <h2 style="
                  font-family: 'caveat', cursive;
                  font-weight: bold;
                  padding-right: 50px;
                ">
                            NuGiBot
                        </h2>
                    </a>
                    <nav class="navbar navbar-expand-lg custom_nav-container" style="
                height: 60px;
                width: 50%;
                margin-right: 300px;
                display: flex;
                border-radius: 40px;
                background-color: #00c6a9;
              ">
                        <button class="navbar-toggler" type="button" data-toggle="collapse"
                            data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
                            aria-expanded="false" aria-label="Toggle navigation">
                            <span class="navbar-toggler-icon"></span>
                        </button>
                        <div class="collapse navbar-collapse" id="navbarSupportedContent">
                            <ul class="navbar-nav mx-auto">
                                <li class="nav-item">
                                    <a class="nav-link" href="/">
                                        <i class="fa fa-home"></i>
                                        <span class="nav-text"></span>
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="/about">
                                        <i class="fa fa-info-circle"></i>
                                        <span class="nav-text"></span>
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="/community">
                                        <i class="fa fa-robot"></i>
                                        <span class="nav-text"></span>
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="/team">
                                        <i class="fa fa-users"></i>
                                        <span class="nav-text"></span>
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="/testimonial">
                                        <i class="fa fa-comments"></i>
                                        <span class="nav-text"></span>
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="/contact">
                                        <i class="fa fa-envelope"></i>
                                        <span class="nav-text"></span>
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </nav>
                </div>
            </div>
        </header>

        <!-- client section -->
        <section class="community layout-padding">
            <h1 style="justify-content: center; display: flex;">Food Track</h1>
            <div class="container">
                <div class="row" style="margin-right: 0px">
                    <div class="col-md-4 col-lg-3 mb-2" style="left:-20px;top: -170px;">
                        <div class="menu flex-row justify-content-between align-items-center">
                            <!-- NuGiBot -->
                            <icon class="material-symbols-outlined" onclick="toggleMenu()">menu</icon>
                        </div>
                        <nav class="nav flex-column sidebar" id="sidebar">
                            <!-- Community Collapse -->
                            <div class="sb-sidenav-menu-heading" style="
                    margin-bottom: 10px;
                    margin-top: 10px;
                    font-size: 0.8rem;
                    font-weight: bold;
                    text-transform: uppercase;
                    color: rgb(150, 149, 149);
                  ">
                                menu
                            </div>
                            <button style="justify-content: center" class="nav-link d-flex align-items-center active"
                                type="button" data-toggle="collapse" data-target="#collapseCommunity"
                                aria-expanded="false" aria-controls="collapseCommunity">
                                <icon class=""></icon>
                                Community
                            </button>
                            <div class="collapse" id="collapseCommunity">
                                <a href="/community/vegan" class="nav-link d-flex align-items-center">
                                    <icon class="mr-2 material-symbols-outlined">spa</icon>
                                    Vegan
                                </a>
                                <a href="/community/diet" class="nav-link d-flex align-items-center">
                                    <icon class="mr-2 material-symbols-outlined">no_meals</icon>
                                    Diet
                                </a>
                            </div>
                            <!-- Features Collapse -->
                            <!-- Features -->
                            <button style="justify-content: center; margin-top: 10px"
                                class="nav-link d-flex align-items-center active" type="button" data-toggle="collapse"
                                data-target="#collapseFeatures" aria-expanded="false" aria-controls="collapseFeatures">
                                <icon class=""></icon>
                                Features
                            </button>
                            <div class="collapse" id="collapseFeatures">
                                <a href="/chatbot" class="nav-link d-flex align-items-center">
                                    <i class="fas fa-robot mr-2"></i>
                                    Chat with NuGiBot
                                </a>
                                <a href="/chart" class="nav-link d-flex align-items-center">
                                    <icon class="mr-2 material-symbols-outlined">show_chart</icon>
                                    Report Progress
                                </a>
                                <a href="/track" class="nav-link d-flex align-items-center">
                                    <icon class="mr-2 material-symbols-outlined">bar_chart</icon>
                                    Food Track
                                </a>
                                <a href="#" class="nav-link d-flex align-items-center" data-bs-toggle="modal"
                                    data-bs-target="#exampleModal">
                                    <icon class="mr-2 material-symbols-outlined">date_range</icon>
                                    Reminder
                                </a>

                                <!-- modal  -->
                                <div class="modal fade" id="exampleModal" tabindex="-1"
                                    aria-labelledby="exampleModalLabel" aria-hidden="true">
                                    <div class="modal-dialog">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h5 class="modal-title fs-5" id="exampleModalLabel">Peringatan Kalorimu
                                                </h5>
                                                <button
                                                    style="padding: .5em; background: none; border: none; color: gray; border-radius: .3em; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center;"
                                                    type="button" class="btn-close" data-bs-dismiss="modal"
                                                    aria-label="Close">
                                                    <i class="material-symbols-outlined m-0">close</i>
                                                </button>
                                            </div>
                                            <div class="modal-body">
                                                Hai, kamu sudah berada di batas kalori harianmu. Mungkin kamu ingin
                                                membatalkan makanan ini?
                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-secondary"
                                                    data-bs-dismiss="modal">Close</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <script
                                    src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
                                    crossorigin="anonymous"></script>
                                <a href="/history" class="nav-link d-flex align-items-center">
                                    <icon class="mr-2 material-symbols-outlined">monitor_heart</icon>
                                    Medical History
                                </a>
                                <a href="/calculator" class="nav-link d-flex align-items-center">
                                    <icon class="mr-2 material-symbols-outlined">calculate</icon>
                                    Weight Calculator
                                </a>
                            </div>

                            <!-- Article -->
                            <button style="justify-content: center; margin-top: 10px"
                                class="nav-link d-flex align-items-center active" type="button" data-toggle="collapse"
                                data-target="#collapseArticle" aria-expanded="false" aria-controls="collapseArticle">
                                <icon class=""></icon>
                                Article
                            </button>
                            <div class="collapse" id="collapseArticle">
                                <a href="/article" class="nav-link d-flex align-items-center">
                                    <i class="fas fa-columns mr-2"></i>
                                    Article
                                </a>
                            </div>
                        </nav>
                    </div>
                </div>
                <!-- Main content -->
                <div class="container">
                    <div class="card-body">
                        <div class="form-horizontal">
                            <div class="form-group" style="margin-top:-70px ;">
                                <label for="jenis-makanan" class="control-label" style="margin-right: 10px;">Food
                                    Type</label>
                                <select name="jenis-makanan" class="form-control" id="jenis-makanan"
                                    style="width: 150px; margin-top: -6px;">
                                    <option value="Breakfast">Breakfast</option>
                                    <option value="Dessert/Camilan">Dessert</option>
                                    <option value="Dinner">Dinner</option>
                                    <option value="Lunch">Lunch</option>
                                </select>
                                <label for="nama-makanan" class="control-label"
                                    style="margin-left: 10px;margin-right: 10px;">Food Name</label>
                                <input type="text" class="form-control" id="nama-makanan"
                                    style="width: 150px; margin-top: -6px;">

                                <div style="display: flex; margin-top:100px; margin-left: -450px;">

                                    <div class="form-group">
                                        <label for="jumlah-kalori" class="control-label"
                                            style="margin-right: 10px; margin-top: 10px;">Calorie <br> /Kcal</label>
                                        <input type="number" class="form-control no-spin" id="jumlah-kalori"
                                            style="width: 70px;">
                                    </div>
                                    <div class="form-group">
                                        <label for="jumlah-gula" class="control-label"
                                            style="margin-left: 10px; margin-right: 10px; margin-top: 10px;">Sugar <br>
                                            /g</label>
                                        <input type="number" class="form-control no-spin" id="jumlah-gula"
                                            style="width: 70px;">
                                    </div>
                                    <div class="form-group">
                                        <label for="jumlah-serat" class="control-label"
                                            style="margin-left: 10px; margin-right: 10px;margin-top: 10px;">Fiber <br>
                                            /g</label>
                                        <input type="number" class="form-control  no-spin" id="jumlah-serat"
                                            style="width: 70px;">
                                    </div>
                                    <div class="form-group">
                                        <label for="jumlah-protein" class="control-label"
                                            style="margin-left: 10px; margin-right: 10px;margin-top: 10px;">Protein <br>
                                            /g</label>
                                        <input type="number" class="form-control no-spin" id="jumlah-protein"
                                            style="width: 70px;">
                                    </div>
                                    <div class="form-group">
                                        <div class="col-sm-offset-2 col-sm-10">
                                            <button onclick="javascript:handleSubmit()" class="btn btn-primary"
                                                style="background-color: #00c6a9; border-color: #00c6a9; margin-left: 0px;">Submit</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                    </div>

                    <!-- Tabel Diletakkan di Bawah -->
                    <div class="card-body"
                        style="border: 1px solid white; background-color: white; padding: 18px; padding-bottom:0px; border-radius: 5px; margin-right: 10px; border: 1px solid rgb(195, 192, 192); margin-bottom: -140px;">
                        <h4 style="font-family: cursive; margin-top: -5px;">Food Table</h4>
                        <table id="table-values" class="table table-bordered table-striped" style="width: 100%;">
                            <thead>
                                <tr>
                                    <th style="text-align: center;">Food Type</th>
                                    <th style="text-align: center;">Food Name</th>
                                    <th style="text-align: center;">Calorie </th>
                                    <th style="text-align: center;">Sugar</th>
                                    <th style="text-align: center;">Fiber</th>
                                    <th style="text-align: center;">Protein</th>
                                    <th style="text-align: center;">Time</th>
                                </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>
                    </div>

                </div>

        </section>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>
    <script src="/static/js/chart1.js"></script>
    <script src="/static/js/chart2.js"></script>
    <script>
        function toggleMenu() {
            var sidebar = document.getElementById("sidebar");
            if (sidebar.style.display === "none" || sidebar.style.display === "") {
                sidebar.style.display = "block";
            } else {
                sidebar.style.display = "none";
            }
        }

    </script>
    <script>
        let dataTable; // Global variable to hold the DataTable instance

        // Function to load table data
        async function loadTableData() {
            try {
                let element = document.getElementById("table-values");
                const response = await fetch('/api/food_track/list');
                const data = await response.json();
                
                // If DataTable already exists, destroy it first
                if (dataTable) {
                    dataTable.destroy();
                }

                // Initialize new DataTable with the fetched data
                dataTable = new simpleDatatables.DataTable(element, {
                    data: {
                        headings: ["Food Type", "Food Name", "Calorie", "Sugar", "Fiber", "Protein", "Time", "Action"],
                        data: data.map(item => [
                            item.foodType,
                            item.foodName,
                            item.calorie,
                            item.sugar,
                            item.fiber,
                            item.protein,
                            item.time,
                            `<button onclick="deleteFood('${item.id}')" class="btn btn-danger btn-sm">
                                <i class="material-icons">delete</i>
                            </button>`
                        ])
                    },
                    searchable: true,
                    perPage: 10,
                    perPageSelect: [5, 10, 15, 20, 25],
                    labels: {
                        placeholder: "Search food...",
                        perPage: " entries per page",
                        noRows: "No entries found",
                        info: "Showing {start} to {end} of {rows} entries"
                    }
                });
            } catch (error) {
                console.error('Error loading table data:', error);
            }
        }

        // Function to handle form submission
        async function handleSubmit() {
            // Get form data using your specific element IDs
            const formData = {
                foodType: document.getElementById('jenis-makanan').value,
                foodName: document.getElementById('nama-makanan').value,
                calorie: document.getElementById('jumlah-kalori').value,
                sugar: document.getElementById('jumlah-gula').value,
                fiber: document.getElementById('jumlah-serat').value,
                protein: document.getElementById('jumlah-protein').value
            };

            try {
                const response = await fetch('/api/food_track/add', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': csrftoken
                    },
                    body: JSON.stringify(formData)
                });

                if (response.ok) {
                    // Reset form and reload table
                    document.getElementById('jenis-makanan').value = '';
                    document.getElementById('nama-makanan').value = '';
                    document.getElementById('jumlah-kalori').value = '';
                    document.getElementById('jumlah-gula').value = '';
                    document.getElementById('jumlah-serat').value = '';
                    document.getElementById('jumlah-protein').value = '';
                    
                    loadTableData(); // This will refresh the DataTable
                } else {
                    console.error('Error submitting form');
                }
            } catch (error) {
                console.error('Error:', error);
            }
        }

        // Function to delete food entry
        async function deleteFood(id) {
            try {
                const response = await fetch('/api/food_track/delete', {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': csrftoken
                    },
                    body: JSON.stringify({ id: id })
                });

                if (response.ok) {
                    loadTableData(); // This will refresh the DataTable
                } else {
                    console.error('Error deleting entry');
                }
            } catch (error) {
                console.error('Error:', error);
            }
        }

        // Add event listeners when document loads
        document.addEventListener('DOMContentLoaded', () => {
            // Load initial table data
            loadTableData();

            // Add form submit handler
            const form = document.querySelector('.form-horizontal');
            form.addEventListener('submit', handleSubmit);
        });
    </script>
    <link href="https://cdn.jsdelivr.net/npm/simple-datatables@7.1.2/dist/style.css" rel="stylesheet">


    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
        crossorigin="anonymous"></script>
    <script src="/static/js/scripts.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.min.js" crossorigin="anonymous"></script>
    <script src="assets/demo/chart-area-demo.js"></script>
    <script src="assets/demo/chart-bar-demo.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/simple-datatables@7.1.2/dist/umd/simple-datatables.min.js"
        crossorigin="anonymous"></script>
    <script src="/static/js/datatables-simple-demo.js"></script>
</body>

</html>